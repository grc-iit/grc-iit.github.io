<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iowarp/components/runtime/modules" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Building Modules | Gnosis Research Center</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://grc.iit.edu/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://grc.iit.edu/img/social-card.png"><meta data-rh="true" property="og:url" content="https://grc.iit.edu/docs/iowarp/components/runtime/modules"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="high-performance computing (hpc), memory and storage systems, scalable software systems, data management, data-centric systems, research center, scalable system software, technology research, computational research, innovative technology, scientific research"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Building Modules | Gnosis Research Center"><meta data-rh="true" name="description" content="Chimaera&#x27;s objective is to be flexible towards a variety of I/O stack designs. The main step"><meta data-rh="true" property="og:description" content="Chimaera&#x27;s objective is to be flexible towards a variety of I/O stack designs. The main step"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://grc.iit.edu/docs/iowarp/components/runtime/modules"><link data-rh="true" rel="alternate" href="https://grc.iit.edu/docs/iowarp/components/runtime/modules" hreflang="en"><link data-rh="true" rel="alternate" href="https://grc.iit.edu/docs/iowarp/components/runtime/modules" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IOWarp","item":"https://grc.iit.edu/docs/category/iowarp"},{"@type":"ListItem","position":2,"name":"Components","item":"https://grc.iit.edu/docs/category/components"},{"@type":"ListItem","position":3,"name":"Building Modules","item":"https://grc.iit.edu/docs/iowarp/components/runtime/modules"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Gnosis Research Center RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Gnosis Research Center Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9SXDPLSLB2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9SXDPLSLB2",{})</script>



<link rel="alternate" type="application/rss+xml" href="/newsletter/rss.xml" title="Gnosis Research Center RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/newsletter/atom.xml" title="Gnosis Research Center Atom Feed"><link rel="stylesheet" href="/assets/css/styles.5529de29.css">
<script src="/assets/js/runtime~main.4f7b3a1e.js" defer="defer"></script>
<script src="/assets/js/main.d2f92168.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Gnosis Research Center" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Gnosis Research Center" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Gnosis Research Center</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Gnosis</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/about">About</a></li><li><a class="dropdown__link" href="/members">Members</a></li><li><a class="dropdown__link" href="/network">Network</a></li><li><a class="dropdown__link" href="/contact">Contact</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Research</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/research/projects">Projects</a></li><li><a class="dropdown__link" href="/research/patents">Patents</a></li><li><a class="dropdown__link" href="/resources/hardware-overview">Hardware Overview</a></li></ul></div><a class="navbar__item navbar__link" href="/news">News</a><a class="navbar__item navbar__link" href="/publications">Publications</a><a class="navbar__item navbar__link" href="/opportunities">Opportunities</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/index">Tutorials</a><a href="https://github.com/grc-iit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS darkNavbarColorModeToggle_X3D1" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/index">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/category/linux-introduction">HPC Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/iowarp">IOWarp</a><button aria-label="Collapse sidebar category &#x27;IOWarp&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/index">IOWarp</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/iowarp/deployment/index">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/components">Components</a><button aria-label="Collapse sidebar category &#x27;Components&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/iowarp/components/ipc/index">Interprocess Communication</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/iowarp/components/runtime/index">IOWarp Runtime</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/index">The IOWarp Runtime: Chimaera</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/code-example">Client API Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/launch-runtime">Launch Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/iowarp/components/runtime/modules">Building Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/deploying-mods">Deploying Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/domains">Domains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/fixed-scheduling">Statically Scheduling Tasks and Concurrency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/dynamic-scheduling">Dynamic Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iowarp/components/runtime/long-running">Long-Running Tasks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/iowarp/components/platform-plugins-interface/index">Platform Plugins Interface</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/content-transfer-engine">Content Transfer Engine</a><button aria-label="Expand sidebar category &#x27;Content Transfer Engine&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/hermes">Hermes</a><button aria-label="Expand sidebar category &#x27;Hermes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/chronolog">ChronoLog</a><button aria-label="Expand sidebar category &#x27;ChronoLog&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/wisio">WisIO</a><button aria-label="Expand sidebar category &#x27;WisIO&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/jarvis/jarvis-util/index">Jarvis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/ares-research-cluster">Ares Research Cluster</a><button aria-label="Expand sidebar category &#x27;Ares Research Cluster&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/iowarp"><span>IOWarp</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/components"><span>Components</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">IOWarp Runtime</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Building Modules</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Building Modules</h1></header>
<p>Chimaera&#x27;s objective is to be flexible towards a variety of I/O stack designs. The main step
to achieve this is through modularity. It is possible to create and dynamically register
new custom modules in the chimaera runtime. This section discusses how this modularity is
achieved and what can be done with it.</p>
<p>We will explain this process by adding an example compression module to a custom repo.
Chimaera does follow a strict naming convention to allow for more
code to be generated. We document here the expectations on certain key variable and class
names to ensure that code is properly generated.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="module-repos">Module Repos<a href="#module-repos" class="hash-link" aria-label="Direct link to Module Repos" title="Direct link to Module Repos">​</a></h2>
<p>In Chimaera, a module (or <strong>ChiMod</strong>) is the code object representing a ChiContainer. These
modules can be registered dynamically in the runtime. A module repo represents a set of
ChiMods. In the example below, we show the set of core modules defined
by Chimaera. These include modules for block devices (bdev), networking (remote_queue),
work orchestration policies (worch_proc_round_robin and worch_queue_round_robin), and lastly
the Chimaera Admin, which is responsible for general runtime tasks (e.g., upgrading modules,
creating new ChiPools, etc.).</p>
<p>In the tree output below, the folder named &quot;tasks&quot; is the module repo.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chimaera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── bdev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── chimaera_admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── remote_queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── small_message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── TASK_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── worch_proc_round_robin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── worch_queue_round_robin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── src</span><br></span></code></pre></div></div>
<p>Module repos can be attached as a subdirectory to a project -- or it can
be the entire project itself. In the above example, we demonstrate a case
where the repo is apart of a broader project.</p>
<p>A module repo can be created as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_make_repo /path/to/repo namespace</span><br></span></code></pre></div></div>
<p>For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_make_repo ~/my_mod_repo example</span><br></span></code></pre></div></div>
<p>The namespace is used to help autogenerate cmakes. When you build your project,
other projects will be able to link to it using &quot;namespace::my_mod_name&quot;.</p>
<p>At this time, the repo should look as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── chimaera_repo.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── CMakeLists.txt</span><br></span></code></pre></div></div>
<ul>
<li><code>chimaera_repo.yaml</code>: Recommended against touching directly. Indicates
this is a module repo and provides some metadata (mainly the namespace).</li>
<li><code>CMakeLists.txt</code>: The cmake that will be used to build the modules
in the repo, when we make them.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bootstrap-a-new-module-in-a-repo">Bootstrap a New Module in a Repo<a href="#bootstrap-a-new-module-in-a-repo" class="hash-link" aria-label="Direct link to Bootstrap a New Module in a Repo" title="Direct link to Bootstrap a New Module in a Repo">​</a></h2>
<p>To create a module, use the <code>chi_make_mod</code> command. This is installed
as part of the library chimaera-util, which is a dependency of iowarp.
Below is an example where we create the compressor module within the
my_mod_repo repo.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_make_mod ~/my_mod_repo/compressor</span><br></span></code></pre></div></div>
<p>In this case, <code>chi_make_mod</code> copy-pastes the TASK_NAME module from chimaera
and renames it (and associated classes / namespaces) to be compressor. The
path does not need to be absolute.</p>
<p>This will create a module with the following directory structure:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── chimaera_repo.yaml  # Repo metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── CMakeLists.txt      # Repo cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── compressor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── chimaera_mod.yaml  # Module metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── CMakeLists.txt     # Module cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── compressor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       ├── compressor_client.h      # Client API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       ├── compressor_lib_exec.h    # (autogenerated from *methods.yaml)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       ├── compressor_methods.h     # (autogenerated from *methods.yaml)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       ├── compressor_methods.yaml  # Task declarations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       └── compressor_tasks.h       # Task struct definitions </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── CMakeLists.txt          # Builds compressor_client and runtime  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── compressor_client.cc    # Client API source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── compressor_monitor.py   # Used for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── compressor_runtime.cc   # Runtime API source</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="refresh-the-module-repo">Refresh the module repo<a href="#refresh-the-module-repo" class="hash-link" aria-label="Direct link to Refresh the module repo" title="Direct link to Refresh the module repo">​</a></h3>
<p>To ensure that the repo&#x27;s cmakes all know of the new module, run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_refresh_repo ~/my_mod_repo</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-compiling">Try Compiling<a href="#try-compiling" class="hash-link" aria-label="Direct link to Try Compiling" title="Direct link to Try Compiling">​</a></h3>
<p>You should be able to compile this code as-is.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j32</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="declare-all-tasks">Declare all tasks<a href="#declare-all-tasks" class="hash-link" aria-label="Direct link to Declare all tasks" title="Direct link to Declare all tasks">​</a></h2>
<p>The first file to consider is the <code>include/compressor/compressor_methods.yaml</code>. This file declares
the set of tasks that your module exposes by giving each task a unique
identifier. By unique, we mean that each task declared within this file should
be distinct. In other words, the ID does not need to be unique across modules.</p>
<p>Your <code>*_methods.yaml</code> file will initially look as follows:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Inherited Methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kCreate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kDestroy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kNodeFailure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kRecover</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kMigrate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kUpgrade</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Custom Methods (start from 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># kCustom: 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># NOTE: When you add a new method, </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># call chi_refresh_repo to update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># all autogenerated files.</span><br></span></code></pre></div></div>
<p>Inherited methods are common across all modules. Of these,
only kCreate is strictly required. The others are optional,
which is indicated by setting -1 to avoid code generation for them.</p>
<p>Custom methods can range from 10 to 2^32. Let&#x27;s add the methods
kCompress and kDecompress.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Inherited Methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kCreate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kDestroy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kNodeFailure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kRecover</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kMigrate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kUpgrade</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Custom Methods (start from 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kCompress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kDecompress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="autogenerate-task-helper-files">Autogenerate task helper files<a href="#autogenerate-task-helper-files" class="hash-link" aria-label="Direct link to Autogenerate task helper files" title="Direct link to Autogenerate task helper files">​</a></h2>
<p>To autogenerate the Compress and Decompress functions, we can run the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_refresh_repo ~/my_mod_repo</span><br></span></code></pre></div></div>
<p>This will edit various files to bootstrap code for you.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autogenerated-tasks-structs">Autogenerated tasks structs<a href="#autogenerated-tasks-structs" class="hash-link" aria-label="Direct link to Autogenerated tasks structs" title="Direct link to Autogenerated tasks structs">​</a></h3>
<p>A task is simply a C++ struct containing the parameters to a function.
Tasks are located in <code>include/compressor/compressor_tasks.h</code>.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** A task to create compressor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">CreateTaskParams</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CLS_CONST </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">lib_name_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example_compressor&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CreateTaskParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CreateTaskParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">serialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Admin</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CreatePoolBaseTask</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTaskParams</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> CreateTask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** A task to destroy compressor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Admin</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">DestroyContainerTask DestroyTask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** The CompressTask task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">CompressTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Task</span><span class="token base-clause punctuation" style="color:#393A34">,</span><span class="token base-clause"> </span><span class="token base-clause class-name">TaskFlags</span><span class="token base-clause operator" style="color:#393A34">&lt;</span><span class="token base-clause class-name">TF_SRL_SYM</span><span class="token base-clause operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** SHM default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kCompress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Duplicate message */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CompressTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** The DecompresssTask task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">DecompresssTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Task</span><span class="token base-clause punctuation" style="color:#393A34">,</span><span class="token base-clause"> </span><span class="token base-clause class-name">TaskFlags</span><span class="token base-clause operator" style="color:#393A34">&lt;</span><span class="token base-clause class-name">TF_SRL_SYM</span><span class="token base-clause operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** SHM default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompresssTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompresssTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kDecompresss</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Duplicate message */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DecompresssTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHI_AUTOGEN_METHODS  </span><span class="token comment" style="color:#999988;font-style:italic">// keep at class bottom</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="chi_begin-chi_end-chi_autogen_methods">CHI_BEGIN, CHI_END, CHI_AUTOGEN_METHODS<a href="#chi_begin-chi_end-chi_autogen_methods" class="hash-link" aria-label="Direct link to CHI_BEGIN, CHI_END, CHI_AUTOGEN_METHODS" title="Direct link to CHI_BEGIN, CHI_END, CHI_AUTOGEN_METHODS">​</a></h4>
<p>Notice that each task is wrapped in CHI_BEGIN and CHI_END.
For example, Decompress:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** The DecompresssTask task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">DecompresssTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Task</span><span class="token base-clause punctuation" style="color:#393A34">,</span><span class="token base-clause"> </span><span class="token base-clause class-name">TaskFlags</span><span class="token base-clause operator" style="color:#393A34">&lt;</span><span class="token base-clause class-name">TF_SRL_SYM</span><span class="token base-clause operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** SHM default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompresssTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompresssTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kDecompresss</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Duplicate message */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DecompresssTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>CHI_BEGIN</code> and <code>CHI_END</code> encapsulate a piece of code
relating to a task. <code>CHI_AUTOGEN_METHODS</code> marks the end
of the class where methods not wrapped in these could be
appended. <code>CHI_AUTOGEN_METHODS</code> is mainly
a fallback and the other decorators are prioritized.</p>
<p>These exist to allow the Chimaera utility library to parse
these files and make edits to them. For example, a task
could be deleted by removing everything between <code>CHI_BEGIN</code> and
<code>CHI_END</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autogenerated-client-apis">Autogenerated client APIs<a href="#autogenerated-client-apis" class="hash-link" aria-label="Direct link to Autogenerated client APIs" title="Direct link to Autogenerated client APIs">​</a></h3>
<p>The next file to look at is your client API: <code>include/compressor/compressor_client.h</code>.
For any application that will interact with your module, this is the API that
they will use.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Create compressor requests */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Client</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">ModuleClient</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Destructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">~</span><span class="token function" style="color:#d73a49">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Create a pool */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">affinity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CreateContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">AsyncCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> affinity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ctx_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Destroy pool + queue */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Destroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CHI_ADMIN</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DestroyContainer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Compress task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Compress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CompressTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncCompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Decompresss task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decompresss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">DecompresssTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncDecompresss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompresss</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The class name should always be Client. However, you can change the namespace however you
like, so long as it is done consistently across all files in the module repo. This
can be easily done in any text editor.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-chi_task_methods">What is CHI_TASK_METHODS?<a href="#what-is-chi_task_methods" class="hash-link" aria-label="Direct link to What is CHI_TASK_METHODS?" title="Direct link to What is CHI_TASK_METHODS?">​</a></h4>
<p><code>CHI_TASK_METHODS</code> is a macro that creates several useful APIs. This primarily
includes methods that abstract lower-level Chimaera APIs for allocating and
submitting tasks.</p>
<p><code>CHI_TASK_METHODS(Create)</code> makes the following methods:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Args</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HSHM_CROSS_FUN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncCreateAlloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Args </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CUSTOM##Task</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token generic-function function" style="color:#d73a49">NewTask</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">CUSTOM##Task</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token generic-function function" style="color:#d73a49">forward</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">Args</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                                                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Args</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HSHM_CROSS_FUN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Args </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token generic-function function" style="color:#d73a49">ScheduleNewTask</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">CreateTask</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token generic-function function" style="color:#d73a49">forward</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">Args</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Args</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HSHM_CROSS_FUN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncCreateBase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Task </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Args </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token generic-function function" style="color:#d73a49">ScheduleNewTask</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">CreateTask</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token generic-function function" style="color:#d73a49">forward</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">Args</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li><code>AsyncCreateAlloc</code>: Allocates a CreateTask (but does not schedule it).
Typically used more for debugging.</li>
<li><code>AsyncCreate</code>: Allocates + schedules a CreateTask. Users will often
call this API.</li>
<li><code>AsyncCreateBase</code>: Allocates + Schedules a task, but explicitly states
whether or not the task was spawned as a subtask of another &quot;parent&quot; task.
This API is generally used only internally.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autogenerated-runtime-apis">Autogenerated runtime APIs<a href="#autogenerated-runtime-apis" class="hash-link" aria-label="Direct link to Autogenerated runtime APIs" title="Direct link to Autogenerated runtime APIs">​</a></h3>
<p>The last file to consider is <code>src/compressor_runtime.cc</code>. This file
contains the code that will be executed by the runtime. It holds
a class named Server. This class should always be named Server.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Server</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Module</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CLS_CONST LaneGroupId kDefaultGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">Server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Construct compressor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CreateTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Create a set of lanes for holding tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">CreateLaneGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kDefaultGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> QUEUE_LOW_LATENCY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Route a task to a lane */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Lane </span><span class="token operator" style="color:#393A34">*</span><span class="token function" style="color:#d73a49">MapTaskToLane</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Task </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">override</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Route tasks to lanes based on their properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// E.g., a strongly consistent filesystem could map tasks to a lane</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// by the hash of an absolute filename path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetLaneByHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kDefaultGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">prio_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Destroy compressor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Destroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DestroyTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorDestroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DestroyTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Destroy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** The Compress method */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Compress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorCompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> MonitorMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kReplicaAgg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replicas_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_BEGIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** The Decompresss method */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decompresss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DecompresssTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorDecompresss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DecompresssTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> MonitorMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kReplicaAgg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replicas_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_END</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;compressor/compressor_lib_exec.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><code>compressor/compressor_lib_exec.h</code> contains methods for routing tasks to the
methods shown here. For example, a task with the method <code>Method::kCompress</code> will
be mapped to the function <code>Compress</code> because of this file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-building">Try building<a href="#try-building" class="hash-link" aria-label="Direct link to Try building" title="Direct link to Try building">​</a></h3>
<p>At this point, the code should compile again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j32</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="customize-your-new-tasks">Customize your new tasks<a href="#customize-your-new-tasks" class="hash-link" aria-label="Direct link to Customize your new tasks" title="Direct link to Customize your new tasks">​</a></h2>
<p>A task is simply a C++ struct containing the parameters to a function.
Tasks are located in <code>include/compressor/compressor_tasks.h</code>.</p>
<p>We will be editing this file now.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-createtask">Define the CreateTask<a href="#define-the-createtask" class="hash-link" aria-label="Direct link to Define the CreateTask" title="Direct link to Define the CreateTask">​</a></h3>
<p>The create task contains the parameters to initialize a ChiPool.
All CreateTasks must provide a constant <code>lib_name_</code>. This is constant is
the base name of the ChiMod shared object (e.g., *.so or *.dll). This value is automatically
generated and shouldn&#x27;t be changed. It corresponds to the
<code>target_link_library</code> command in the cmake file that is also autogenerated.</p>
<p>In our case, we will modify CreateTaskParams to include the identifier of a
compression library. We modify the non-default constructor and the serialization function.
The serialization function in particular is important.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">CreateTaskParams</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CLS_CONST </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">lib_name_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example_compressor&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> compress_id_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CreateTaskParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CreateTaskParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> compress_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compress_id_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> compress_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">serialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">compress_id_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Admin</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CreatePoolBaseTask</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTaskParams</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> CreateTask</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-compresstask">Define the CompressTask<a href="#define-the-compresstask" class="hash-link" aria-label="Direct link to Define the CompressTask" title="Direct link to Define the CompressTask">​</a></h3>
<p>The CompressTask has two main inputs: a buffer pointing to data to compress
and the size of the data.</p>
<p>Below, we show our modified <code>CompressTask</code>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">CompressTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Task</span><span class="token base-clause punctuation" style="color:#393A34">,</span><span class="token base-clause"> </span><span class="token base-clause class-name">TaskFlags</span><span class="token base-clause operator" style="color:#393A34">&lt;</span><span class="token base-clause class-name">TF_SRL_SYM</span><span class="token base-clause operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IN size_t data_size_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** SHM default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kCompress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Duplicate message */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CompressTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_size_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">UnsetDataOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_WRITE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>NOTE: Tasks are not directly compatible with virtual functions.
Tasks are generally stored and allocated in shared memory. Since function
addresses are not consistent across processes, using virtual functions,
raw pointers, and STL data structures is generally erronous.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="task-inheritance">Task inheritance<a href="#task-inheritance" class="hash-link" aria-label="Direct link to Task inheritance" title="Direct link to Task inheritance">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">CompressTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TaskFlags</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TF_SRL_SYM</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>CompressTask inherit from two base classes <code>Task</code> and <code>TaskFlags</code>.
The <code>Task</code> class contains various variables and helper functions which
will be discussed more later.</p>
<p><code>TaskFlags</code> is used to enable/disable certain methods of a task.
In this case, TF_SRL_SYM means &quot;this task can be serialized
and transferred over a network.&quot; The alternative is TF_LOCAL,
which means &quot;This task executes on this node only.&quot;</p>
<p>When using TF_SRL_SYM, all of these methods are required to be implemented.
When using TF_LOCAL, only CopyStart is required.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="task-variables">Task variables<a href="#task-variables" class="hash-link" aria-label="Direct link to Task variables" title="Direct link to Task variables">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">IN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IN size_t data_size_</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Variables can be prefixed with the keywords
IN, OUT, or INOUT.</p>
<ul>
<li><code>IN</code>: This is an input.</li>
<li><code>OUT</code>: This is an output.</li>
<li><code>INOUT</code>: This is an input and an output.</li>
</ul>
<p>These decorators are not required. They are simply
empty macros. However, they help with the readability
of your code.</p>
<p>In our case, data_ and data_size_ are parameters
the user gives as input.</p>
<p>Why <code>hipc::Pointer</code> instead of <code>char *</code>? Because
<code>char *</code> refers to an address in the process&#x27;s address
space. Since Chimaera runs in a different address space
as a separate process, all pointers must be compatible
with shared memory. This is what <code>hipc::Pointer</code> does.
This avoids a very expensive data copy.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="emplace-constructor-method-signature">Emplace constructor: Method Signature<a href="#emplace-constructor-method-signature" class="hash-link" aria-label="Direct link to Emplace constructor: Method Signature" title="Direct link to Emplace constructor: Method Signature">​</a></h4>
<p>The emplace constructor for our CompressTask is below:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The emplace constructor is most important. This constructor
should contain all parameters to intialize the task. Every
emplace constructor must start with the following 4 variables:</p>
<ul>
<li><code>const hipc::CtxAllocator&lt;CHI_ALLOC_T&gt; &amp;alloc</code>: The allocator used
to allocate this task. Automatically generated by higher-level APIs.</li>
<li><code>const TaskNode &amp;task_node</code>: The unique identifier of this task in the
system. Automatically passed by higher-level APIs.</li>
<li><code>const PoolId &amp;pool_id</code>: The ChiPool this task belongs to.</li>
<li><code>const DomainQuery &amp;dom_query</code>: The set of ChiContainers in the ChiPool
the task can be sent to. More discussion on domains will be later</li>
</ul>
<p>We then have our two custom variables that come afterwards:</p>
<ul>
<li><code>const hipc::Pointer &amp;data</code>: The process-independent pointer to some
data.</li>
<li><code>size_t data_size</code>: The total size of data.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="emplace-constructor-core-task-parameters">Emplace Constructor: Core Task Parameters<a href="#emplace-constructor-core-task-parameters" class="hash-link" aria-label="Direct link to Emplace Constructor: Core Task Parameters" title="Direct link to Emplace Constructor: Core Task Parameters">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kCompress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Next we look at the basic parameters being set. The main things
that were not described in the previous section are:</p>
<ul>
<li><code>prio_</code>: The priority of this task. Can either be kLowLatency or kHighLatency.
Tasks with different priority are placed on different queues and may be executed
out-of-order. This is a performance optimization.</li>
<li><code>method_</code>: This is the method that will process the task. Remember the <code>compress_methods.yaml</code>
file? A new file called <code>compress_methods.h</code> was generated from that file, which is where these
methods are defined.</li>
<li><code>task_flags_</code>: By default, no flags. There is another section describing the potential flags
that can go here -- most of which are related to performance.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="emplace-constructor-custom-parameters">Emplace Constructor: Custom Parameters<a href="#emplace-constructor-custom-parameters" class="hash-link" aria-label="Direct link to Emplace Constructor: Custom Parameters" title="Direct link to Emplace Constructor: Custom Parameters">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kCompress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The last part is the custom parameters. Not much magic here,
just set them.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="copystart">CopyStart<a href="#copystart" class="hash-link" aria-label="Direct link to CopyStart" title="Direct link to CopyStart">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CompressTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_size_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">UnsetDataOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The CopyStart method is used to duplicate a task. It takes
as input the other task (i.e., the original task) and
a parameter named &quot;deep&quot;, which indicates how much to copy.</p>
<p>In general, deep is false. deep true is generally optional and
will likely be considered legacy / deprecated in the future.
This would only need to be implemented if the module developer
needed deep copies for their specific situation.</p>
<p>In this example, we assume deep is always false. If deep is
false, we mark this task as &quot;not owning the data&quot;. This means
that when the task is eventually freed, the data pointer
will not be destroyed here.</p>
<p>Copies can happen within the networking module of chimaera.
For example, for replication, a task may be duplicated
to each container it is sent to.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="serializestart">SerializeStart<a href="#serializestart" class="hash-link" aria-label="Direct link to SerializeStart" title="Direct link to SerializeStart">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_WRITE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This function is called by the remote_queue module of chimaera.
It serializes the custom parameters of the task.</p>
<p>ar.bulk will serialize the data pointer. DT_WRITE means &quot;I&#x27;m writing
data_ of size data_size_ to the remote host&quot;.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="serializeend">SerializeEnd<a href="#serializeend" class="hash-link" aria-label="Direct link to SerializeEnd" title="Direct link to SerializeEnd">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This function is called when the task completes on the remote node.
In this case there are no return values, so this is just empty.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-decompresstask">Define the DecompressTask<a href="#define-the-decompresstask" class="hash-link" aria-label="Direct link to Define the DecompressTask" title="Direct link to Define the DecompressTask">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">DecompressTask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">Task</span><span class="token base-clause punctuation" style="color:#393A34">,</span><span class="token base-clause"> </span><span class="token base-clause class-name">TaskFlags</span><span class="token base-clause operator" style="color:#393A34">&lt;</span><span class="token base-clause class-name">TF_SRL_SYM</span><span class="token base-clause operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IN hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  INOUT size_t data_size_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** SHM default constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DecompressTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CHI_ALLOC_T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> TaskNode </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PoolId </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_node_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prio_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TaskPrioOpt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pool_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kDecompress</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dom_query_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Duplicate message */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CopyStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DecompressTask </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_size_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_size_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">deep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">UnsetDataOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_EXPOSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_WRITE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The main difference here is the implementations of SerializeStart and SerializeEnd.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="serializestart-1">SerializeStart<a href="#serializestart-1" class="hash-link" aria-label="Direct link to SerializeStart" title="Direct link to SerializeStart">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message call */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_EXPOSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In this case, we are only &quot;exposing&quot; the buffer for I/O operations.
This means the remote node will not actually copy the data_ buffer.
It will just have the ability to access that buffer.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="serializeend-1">SerializeEnd<a href="#serializeend-1" class="hash-link" aria-label="Direct link to SerializeEnd" title="Direct link to SerializeEnd">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** (De)serialize message return */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Ar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SerializeEnd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Ar </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ar</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bulk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DT_WRITE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>When the DecompressTask finishes, it will write the modified
data buffer back to the original host.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-your-client-api">Define your Client API<a href="#define-your-client-api" class="hash-link" aria-label="Direct link to Define your Client API" title="Direct link to Define your Client API">​</a></h2>
<p>The next file to look at is your client API: <code>include/compressor/compressor_client.h</code>.
For any application that will interact with your module, this is the API that
they will use.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-create">Modify Create<a href="#modify-create" class="hash-link" aria-label="Direct link to Modify Create" title="Direct link to Modify Create">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Create a pool */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HSHM_INLINE_CROSS_FUN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">affinity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pool_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CreateContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> compress_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">AsyncCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> affinity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> compress_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ctx_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>If you recall, the CompressTask takes as input the type of compression to apply.
We add this parameter to the create method and pass as the last. <code>AsyncCreate</code>
internally constructs the <code>CreateTaskParams</code> struct that we mentioned earlier
in the chapter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-compress--decompress">Modify Compress + Decompress<a href="#modify-compress--decompress" class="hash-link" aria-label="Direct link to Modify Compress + Decompress" title="Direct link to Modify Compress + Decompress">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Compress task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Compress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CompressTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">AsyncCompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Compress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Decompress task */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">MemContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> DomainQuery </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Pointer </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size_t data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">DecompressTask</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">AsyncDecompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">DelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">CHI_TASK_METHODS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>We additionally pass the data and data_size parameters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-your-runtime-implementation">Define your Runtime implementation<a href="#define-your-runtime-implementation" class="hash-link" aria-label="Direct link to Define your Runtime implementation" title="Direct link to Define your Runtime implementation">​</a></h2>
<p>The last file to consider is <code>src/compressor_runtime.cc</code>. This file
contains the code that will be executed by the runtime. It holds
a class named Server. This class should always be named Server.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-create-1">Modify Create<a href="#modify-create-1" class="hash-link" aria-label="Direct link to Modify Create" title="Direct link to Modify Create">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Construct compressor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CreateTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Create a set of lanes for holding tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">CreateLaneGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kDefaultGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> QUEUE_LOW_LATENCY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorCreate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This method is used to effectively construct the module. The first line of this
file should always be CreateLaneGroup. Lanes are essentially threads. A LaneGroup
is a set of threads that behave similarly and execute similar types of tasks.
Change the number of lanes to potentially have more concurrency in your module.</p>
<p>In this case, there is only one lane group -- the default group. There is only
one lane in the lane group. You can change
this to be separate groups. One situation is different lanes for metadata and data.
Alternatively, different lanes for tasks that run forever vs tasks that execute
and terminate deterministically. Generally, tasks that run forever should always
be mapped to a different lane than those that have a definite end.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="review-maptasktolane">Review MapTaskToLane<a href="#review-maptasktolane" class="hash-link" aria-label="Direct link to Review MapTaskToLane" title="Direct link to Review MapTaskToLane">​</a></h3>
<p>This function is what routes a task to a specific lane. In this case, the algorithm
is fairly simple: route to the first lane.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** Route a task to a lane */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Lane </span><span class="token operator" style="color:#393A34">*</span><span class="token function" style="color:#d73a49">MapTaskToLane</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Task </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">override</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Route tasks to lanes based on their properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// E.g., a strongly consistent filesystem could map tasks to a lane</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// by the hash of an absolute filename path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetLaneByHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kDefaultGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">prio_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>More complex implementations of this could be to track the amount of
work each lane has to do and send tasks to lanes based on their load.</p>
<p>Alternatively, one could send tasks to lanes depending on data dependencies.
For example, buckets of a key-value store could be represented as different
lanes, and tasks for reading and writing from a bucket are stored in the same lane.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-decompress-and-compress">Modify Decompress and Compress<a href="#modify-decompress-and-compress" class="hash-link" aria-label="Direct link to Modify Decompress and Compress" title="Direct link to Modify Decompress and Compress">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** The Compress method */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Compress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorCompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> MonitorMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kReplicaAgg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replicas_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** The Decompress method */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DecompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorDecompress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MonitorModeId mode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DecompressTask </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         RunContext </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> MonitorMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kReplicaAgg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">rctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replicas_</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-the-monitor-methods">What are the Monitor* methods?<a href="#what-are-the-monitor-methods" class="hash-link" aria-label="Direct link to What are the Monitor* methods?" title="Direct link to What are the Monitor* methods?">​</a></h3>
<p>The &quot;Monitor*&quot; functions (e.g., MonitorCompress) are used for handling
events for a specific type of task.</p>
<p>One of these MonitorModes is <code>kReplicaAgg</code>, which is an event called
by the remote_queue for when a task was replicated -- and we are now
aggregating the results of that into a single task.</p>
<p>For now, we leave this as-is. The current implementation of the function
essentially does nothing.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compile--install">Compile + Install<a href="#compile--install" class="hash-link" aria-label="Direct link to Compile + Install" title="Direct link to Compile + Install">​</a></h2>
<p>To compile and install the module repo:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scspkg create my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/my_mod_repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake ../ -DCMAKE_INSTALL_PREFIX=$(scspkg pkg root my_mod_repo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j32 install</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="invoking-your-mods">Invoking your mods<a href="#invoking-your-mods" class="hash-link" aria-label="Direct link to Invoking your mods" title="Direct link to Invoking your mods">​</a></h2>
<p>In the previous example, we created the compressor mod.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;compressor/compressor_client.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">CHIMAERA_CLIENT_INIT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">compressor</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Client client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HSHM_MCTX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token class-name">DomainQuery</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetDirectHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">SubDomainId</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kGlobalContainers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token class-name">DomainQuery</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetGlobalBcast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ipc_test&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  size_t data_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hshm</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token class-name">Unit</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">size_t</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Megabytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hipc</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> orig_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CHI_CLIENT</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">AllocateBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Compress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token class-name">DomainQuery</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetLocalHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orig_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shm_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  data_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This will create the compressor module and then compress some data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="link-to-your-mods-internally">Link to your mods (Internally)<a href="#link-to-your-mods-internally" class="hash-link" aria-label="Direct link to Link to your mods (Internally)" title="Direct link to Link to your mods (Internally)">​</a></h2>
<p>Maybe you want to use your modules in the project they
are being built (internally). Below is an example cmake.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.25)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(internal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(internal internal.cc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(internal example::compressor_client)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="link-to-your-mods-externally">Link to your mods (Externally)<a href="#link-to-your-mods-externally" class="hash-link" aria-label="Direct link to Link to your mods (Externally)" title="Direct link to Link to your mods (Externally)">​</a></h2>
<p>For projects that are external to the mod repo, you
can link to it by finding the Example config.</p>
<p>Below is an example CMake:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.25)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(external)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(Chimaera CONFIG REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(Example CONFIG REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(external external.cc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(external example::compressor_client)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="locate-your-module">Locate your module<a href="#locate-your-module" class="hash-link" aria-label="Direct link to Locate your module" title="Direct link to Locate your module">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">find_package</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Example CONFIG REQUIRED</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The find_package for your mod repo will be in &quot;uppercase camel case&quot; format
of the repo namespace. If you recall, we created the module repo with the
following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chi_make_repo ~/my_mod_repo example</span><br></span></code></pre></div></div>
<p>In this case, the namespace we passed to <code>chi_make_repo</code> is <code>example</code>.
So in this case, our find_package would take as input <code>Example</code> (the upper camel case of <code>example</code>).
If the namespace were <code>hello_example</code>, the find_package would
be <code>HelloExample</code> instead.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="target-link-libraries">Target link libraries<a href="#target-link-libraries" class="hash-link" aria-label="Direct link to Target link libraries" title="Direct link to Target link libraries">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">target_link_libraries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">external example</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">compressor_client</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>There are two targets that you can access here:</p>
<ol>
<li><code>example::compressor_client</code>: Contains the APIs for the client</li>
<li><code>example::compressor_client_gpu</code>: Contains APIs for the client,
which can be called from GPU. Assumes Chimaera was compiled with
either CUDA or ROCm.</li>
</ol>
<p>The <code>example::</code> prefixing the <code>compressor_client</code> is given by the
repo namespace. It is in snake case. If the namespace were hello_example,
then it would be <code>hello_example::compressor_client</code>.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/iowarp/components/runtime/launch-runtime"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Launch Runtime</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/iowarp/components/runtime/deploying-mods"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploying Modules</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#module-repos" class="table-of-contents__link toc-highlight">Module Repos</a></li><li><a href="#bootstrap-a-new-module-in-a-repo" class="table-of-contents__link toc-highlight">Bootstrap a New Module in a Repo</a><ul><li><a href="#refresh-the-module-repo" class="table-of-contents__link toc-highlight">Refresh the module repo</a></li><li><a href="#try-compiling" class="table-of-contents__link toc-highlight">Try Compiling</a></li></ul></li><li><a href="#declare-all-tasks" class="table-of-contents__link toc-highlight">Declare all tasks</a></li><li><a href="#autogenerate-task-helper-files" class="table-of-contents__link toc-highlight">Autogenerate task helper files</a><ul><li><a href="#autogenerated-tasks-structs" class="table-of-contents__link toc-highlight">Autogenerated tasks structs</a></li><li><a href="#autogenerated-client-apis" class="table-of-contents__link toc-highlight">Autogenerated client APIs</a></li><li><a href="#autogenerated-runtime-apis" class="table-of-contents__link toc-highlight">Autogenerated runtime APIs</a></li><li><a href="#try-building" class="table-of-contents__link toc-highlight">Try building</a></li></ul></li><li><a href="#customize-your-new-tasks" class="table-of-contents__link toc-highlight">Customize your new tasks</a><ul><li><a href="#define-the-createtask" class="table-of-contents__link toc-highlight">Define the CreateTask</a></li><li><a href="#define-the-compresstask" class="table-of-contents__link toc-highlight">Define the CompressTask</a></li><li><a href="#define-the-decompresstask" class="table-of-contents__link toc-highlight">Define the DecompressTask</a></li></ul></li><li><a href="#define-your-client-api" class="table-of-contents__link toc-highlight">Define your Client API</a><ul><li><a href="#modify-create" class="table-of-contents__link toc-highlight">Modify Create</a></li><li><a href="#modify-compress--decompress" class="table-of-contents__link toc-highlight">Modify Compress + Decompress</a></li></ul></li><li><a href="#define-your-runtime-implementation" class="table-of-contents__link toc-highlight">Define your Runtime implementation</a><ul><li><a href="#modify-create-1" class="table-of-contents__link toc-highlight">Modify Create</a></li><li><a href="#review-maptasktolane" class="table-of-contents__link toc-highlight">Review MapTaskToLane</a></li><li><a href="#modify-decompress-and-compress" class="table-of-contents__link toc-highlight">Modify Decompress and Compress</a></li><li><a href="#what-are-the-monitor-methods" class="table-of-contents__link toc-highlight">What are the Monitor* methods?</a></li></ul></li><li><a href="#compile--install" class="table-of-contents__link toc-highlight">Compile + Install</a></li><li><a href="#invoking-your-mods" class="table-of-contents__link toc-highlight">Invoking your mods</a></li><li><a href="#link-to-your-mods-internally" class="table-of-contents__link toc-highlight">Link to your mods (Internally)</a></li><li><a href="#link-to-your-mods-externally" class="table-of-contents__link toc-highlight">Link to your mods (Externally)</a><ul><li><a href="#locate-your-module" class="table-of-contents__link toc-highlight">Locate your module</a></li><li><a href="#target-link-libraries" class="table-of-contents__link toc-highlight">Target link libraries</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Gnosis Research Center</div><ul class="footer__items clean-list"><li class="footer__item">
                  <p>
                    Stuart Building <br>
                    Room 112i and 010 <br>
                    10 W. 31st Street <br>
                    Chicago, Illinois 60616
                  </p>
                </li><li class="footer__item">
                  <p>
                    Email: <a href="mailto:grc@illinoistech.edu" target="_blank" rel="noopener noreferrer">grc@illinoistech.edu</a> <br>
                    Phone: <a href="tel:3125676885" target="_blank" rel="noopener noreferrer">+1 312 567 6885</a>
                  </p>
                </li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Featured Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/research/projects/iowarp">IOWarp</a></li><li class="footer__item"><a class="footer__link-item" href="/research/projects/chronolog">ChronoLog</a></li><li class="footer__item"><a class="footer__link-item" href="/research/projects/labios">LABIOS</a></li><li class="footer__item"><a class="footer__link-item" href="/research/projects/coeus">Coeus</a></li><li class="footer__item"><a class="footer__link-item" href="/research/projects/hermes">Hermes</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Tutorials</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/linux-introduction">Linux Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/installing-hpc-software">Installing HPC Software</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/important-environment-variables">Important Environment Variables</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/c-introduction">C++ Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/ares-research-cluster">Ares User Guide</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/careers">GRC Careers</a></li><li class="footer__item"><a href="https://github.com/grc-iit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GRC GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/gnosis-research-center/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GRC LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/grc_iit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GRC X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCNtEyAt4_ckpIbX-gSv8sww" target="_blank" rel="noopener noreferrer" class="footer__link-item">GRC YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.iit.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Illinois Tech<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="http://cs.iit.edu/~scs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SCS Lab<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Gnosis Research Center (GRC).</div></div></div></footer></div>
</body>
</html>