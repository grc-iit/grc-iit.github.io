"use strict";(self.webpackChunkgrc=self.webpackChunkgrc||[]).push([[42800],{2779:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"iowarp/components/runtime/long-running","title":"Long-Running Tasks","description":"Long-running (i.e., periodic) tasks are periodically scheduled on an interval.","source":"@site/docs/11-iowarp/03-components/03-runtime/09-long-running.md","sourceDirName":"11-iowarp/03-components/03-runtime","slug":"/iowarp/components/runtime/long-running","permalink":"/docs/iowarp/components/runtime/long-running","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Dynamic Scheduling","permalink":"/docs/iowarp/components/runtime/dynamic-scheduling"},"next":{"title":"Jarvis","permalink":"/docs/iowarp/components/platform-plugins-interface/index"}}');var o=s(74848),t=s(28453);const r={},l="Long-Running Tasks",c={},a=[];function d(n){const e={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"long-running-tasks",children:"Long-Running Tasks"})}),"\n",(0,o.jsx)(e.p,{children:"Long-running (i.e., periodic) tasks are periodically scheduled on an interval.\nThis can be used for things like monitoring and batching requests."}),"\n",(0,o.jsx)(e.p,{children:"Below is an example of PollStatsTask, which gets periodically scheduled."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-cpp",children:'struct PollStatsTask : public Task, TaskFlags<TF_SRL_SYM> {\n  OUT BdevStats stats_;\n\n  /** SHM default constructor */\n  HSHM_INLINE_CROSS_FUN\n  explicit PollStatsTask(const hipc::CtxAllocator<CHI_ALLOC_T> &alloc)\n      : Task(alloc) {}\n\n  /** Emplace constructor */\n  HSHM_INLINE_CROSS_FUN\n  explicit PollStatsTask(const hipc::CtxAllocator<CHI_ALLOC_T> &alloc,\n                         const TaskNode &task_node, const PoolId &pool_id,\n                         const DomainQuery &dom_query, u32 period_ms)\n      : Task(alloc) {\n    // Initialize task\n    task_node_ = task_node;\n    pool_ = pool_id;\n    method_ = Method::kPollStats;\n    if (period_ms) {\n      task_flags_.SetBits(TASK_PERIODIC);\n      prio_ = TaskPrioOpt::kHighLatency;\n    } else {\n      task_flags_.SetBits(0);\n      prio_ = TaskPrioOpt::kLowLatency;\n    }\n    dom_query_ = dom_query;\n\n    SetPeriodMs(period_ms);\n    HILOG(kInfo, "PollStatsTask: period_ms={}", period_ms);\n  } \n};\n'})}),"\n",(0,o.jsx)(e.p,{children:"There are two things that make a task scheduled periodically."}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"task_flags_.SetBits(TASK_PERIODIC)"}),": This will mark the task as periodically scheduled. There is now a\n",(0,o.jsx)(e.code,{children:"TASK_LONG_RUNNING"})," flag which is an alias to ",(0,o.jsx)(e.code,{children:"TASK_PERIODIC"}),"."]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"SetPeriodMs(period_ms)"}),": This sets the minimum amount of time to elapse before rescheduling this task."]}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"There are several different timing functions:"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"SetPeriodNs"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"SetPeriodUs"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"SetPeriodMs"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"SetPeriodSec"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.code,{children:"SetPeriodMin"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>l});var i=s(96540);const o={},t=i.createContext(o);function r(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);