"use strict";(self.webpackChunkgrc=self.webpackChunkgrc||[]).push([[1105],{63318:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"iowarp/deployment/deploy-hermes-with-ior","title":"Deploying Hermes with an Application","description":"As previously stated, Jarvis can be used to deploy and application","source":"@site/docs/11-iowarp/02-deployment/04-deploy-hermes-with-ior.md","sourceDirName":"11-iowarp/02-deployment","slug":"/iowarp/deployment/deploy-hermes-with-ior","permalink":"/docs/iowarp/deployment/deploy-hermes-with-ior","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Deploy Hermes Alone","permalink":"/docs/iowarp/deployment/deploy-hermes-solo"},"next":{"title":"Components","permalink":"/docs/category/components"}}');var s=i(74848),a=i(28453);const o={},t="Deploying Hermes with an Application",l={},h=[{value:"Build an Environment",id:"build-an-environment",level:2},{value:"Copy the IOR Pipeline",id:"copy-the-ior-pipeline",level:2},{value:"Load the pipeline",id:"load-the-pipeline",level:2},{value:"Run the Pipeline",id:"run-the-pipeline",level:2},{value:"Cleanup",id:"cleanup",level:2},{value:"Why is my application hanging?",id:"why-is-my-application-hanging",level:2},{value:"Resource Graph Misconfiguration",id:"resource-graph-misconfiguration",level:3},{value:"Dependency Problems",id:"dependency-problems",level:3},{value:"Machine Misconfiguration",id:"machine-misconfiguration",level:3},{value:"Permissions Problems",id:"permissions-problems",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"deploying-hermes-with-an-application",children:"Deploying Hermes with an Application"})}),"\n",(0,s.jsx)(n.p,{children:"As previously stated, Jarvis can be used to deploy and application\nwith Hermes. This will automatically set environment variables\n(e.g., LD_PRELOAD) that will be necessary for the application to\nrun. This assumes the application is integrated with Jarvis."}),"\n",(0,s.jsx)(n.p,{children:"This example, the application is the IOR benchmark."}),"\n",(0,s.jsx)(n.h2,{id:"build-an-environment",children:"Build an Environment"}),"\n",(0,s.jsx)(n.p,{children:"We will now load all necessary environment variables and build a\nJarvis environment named hermes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"spack install ior\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"spack load iowarp\nspack load ior\njarvis env build hermes\n"})}),"\n",(0,s.jsx)(n.h2,{id:"copy-the-ior-pipeline",children:"Copy the IOR Pipeline"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jarvis ppl index copy jarvis_hermes.test_ior\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will create a pipeline script named ",(0,s.jsx)(n.code,{children:"test_ior.yaml"})," in your\ncurrent working directory that contains the following:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"name: hermes_unit_ior\nenv: hermes\npkgs:\n  # Launch IOWarp runtime\n  - pkg_type: chimaera_run\n    pkg_name: chimaera_run\n    sleep: 5\n    do_dbg: false\n    dbg_port: 4000\n    port: 6000\n    modules: ['hermes_hermes_core']\n  # Add hermes to the runtime\n  - pkg_type: hermes_run\n    pkg_name: hermes_run\n    do_dbg: false\n    dbg_port: 4000\n  # Intercept client I/O calls\n  - pkg_type: hermes_api\n    pkg_name: hermes_api\n    mpi: true\n  # Launch IOR\n  - pkg_type: ior\n    pkg_name: ior\n    api: mpiio\n    out: /tmp/test_hermes/ior.bin  # Output directory\n    xfer: 1m\n    block: 32m\n    nprocs: 4  # Total number of processes\n    ppn: 1  # Process per node\n"})}),"\n",(0,s.jsx)(n.p,{children:"NOTE: Hermes creates the file named libhermes_hermes_core.so,\nwhich is why we use hermes_hermes_core as the module name here."}),"\n",(0,s.jsx)(n.p,{children:"You can edit the parameters to this script. E.g., change number\nof processes in IOR, buffering locations, etc. This file does not\ndemonstrate every single parameter of iowarp, but gives some\nconfiguration options."}),"\n",(0,s.jsx)(n.p,{children:"To view the arguments for the cte and iowarp runtime:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jarvis pkg help hermes_run\njarvis pkg help chimaera_run\n"})}),"\n",(0,s.jsx)(n.h2,{id:"load-the-pipeline",children:"Load the pipeline"}),"\n",(0,s.jsx)(n.p,{children:"Load the IOR yaml:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jarvis ppl load yaml test_ior.yaml\n"})}),"\n",(0,s.jsx)(n.h2,{id:"run-the-pipeline",children:"Run the Pipeline"}),"\n",(0,s.jsx)(n.p,{children:"To run the pipeline:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jarvis ppl run\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,s.jsx)(n.p,{children:"The following will delete intermediate data generated by Hermes + IOR:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"jarvis ppl clean\n"})}),"\n",(0,s.jsx)(n.h2,{id:"why-is-my-application-hanging",children:"Why is my application hanging?"}),"\n",(0,s.jsx)(n.h3,{id:"resource-graph-misconfiguration",children:"Resource Graph Misconfiguration"}),"\n",(0,s.jsxs)(n.p,{children:["Commonly, the cause is a misconfiguration in the resource graph, specifically\nwith the network section. If the resource graph is misconfigured, Hermes may\ncrash with a ",(0,s.jsx)(n.code,{children:"mercury->fatal"})," error and ultimately cause the program to stall\nforever. Make sure that the domain, provider, and fabric are valid. To view the\nHermes configuration to see which network was selected from your resource graph,\nyou can run:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat $(jarvis path)/hermes_run/hermes_server.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dependency-problems",children:"Dependency Problems"}),"\n",(0,s.jsx)(n.p,{children:"If you are using the MPI-IO interceptor, make sure that the MPI that Hermes\ncompiled with is equivalent to the one your application was compiled with.\nYou may have multiple versions of MPI installed and if you didn't specify\nwhich one when installing Hermes and your program -- they may be different."}),"\n",(0,s.jsx)(n.p,{children:"If you are using the VFD, make sure the VFD was compiled with the same HDF5\nas the application."}),"\n",(0,s.jsx)(n.p,{children:"To view the dependencies of your installed Hermes, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"spack find -c -d hermes\n"})}),"\n",(0,s.jsx)(n.h3,{id:"machine-misconfiguration",children:"Machine Misconfiguration"}),"\n",(0,s.jsx)(n.p,{children:"We have found certain instances where using semantic hostnames in the hostfile\nhas resulted in incorrect behavior. If the machine is misconfigured, it is\npossible that a hostname maps to a different network domain on different nodes.\nTo verify this, you can try using exact IP addresses in your hostfile."}),"\n",(0,s.jsxs)(n.p,{children:["To view your machine's IP addresses, you can run\n",(0,s.jsx)(n.code,{children:"ip addr show"})," or ",(0,s.jsx)(n.code,{children:"fi_info | grep fabric"})]}),"\n",(0,s.jsx)(n.h3,{id:"permissions-problems",children:"Permissions Problems"}),"\n",(0,s.jsx)(n.p,{children:"If you cannot SSH between machines or if your known_hosts file is outdated,\nit is possible that Hermes will fail to launch due to permissions problems\non the network. Make sure that you can SSH between machines without error."})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>t});var r=i(96540);const s={},a=r.createContext(s);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);